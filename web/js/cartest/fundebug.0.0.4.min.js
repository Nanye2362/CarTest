!function(e){function t(){var e=document.currentScript;if(!e){var t=document.scripts;e=t[t.length-1]}return e}function n(e,t,n){var r=e[t];e[t]=n(r)}function r(e){return"function"!=typeof e?e:(e.__injected__||(e.__injected__=function(){try{return e.apply(this,arguments)}catch(e){throw c(e),v=!0,e}}),e.__injected__)}function a(e){var t=/^[0-9a-z]{64}$/i;return!(!e||!e.match(t))}function i(e){return e?{name:e&&e.name,message:e&&e.message,fileName:e&&e.fileName||e&&e.sourceURL,lineNumber:e&&e.lineNumber||e&&e.line,columnNumber:e&&e.columnNumber||e&&e.column}:null}function o(){var e;try{throw new Error("")}catch(t){e=t.stack}if(e)return e=e.replace(/(.*?)fundebug(.*?)\.js(.*)\n?/gm,""),e=e.replace(/^Error\n/g,""),e="generated-stack:\n"+e}function u(){for(var e,t=[],n=arguments.callee.caller.caller;n&&t.length<10;){var r=n.toString().match(/function\s*([\w\_$]+)?\s*\(/i);e=r&&r[1]||"[anonymous]",t.push(e),n=n.caller}return"generated-stack:\n"+t.join("\n")}function c(e){if(e){var t=e.stack;t=t.replace(/(.*?)fundebug(.*?)\.js(.*)\n?/gm,"");var n=i(e);p({name:n.name||"uncaught error",message:n.message,fileName:n.fileName,lineNumber:n.lineNumber,columnNumber:n.columnNumber,stacktrace:t,severity:"error",type:"uncaught"})}}function s(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r='"'+n+'":',a=e[n];a&&("object"==typeof a?r+=s(a):"number"==typeof a?r+=a:r=r+'"'+a.replace(/\n/g,"\\n")+'"',t.push(r))}return"{"+t.join(",")+"}"}function l(e){b.push(e),b.length>20&&b.shift()}function m(t){var n;n=t.target?t.target:t.srcElement;var r=n&&n.outerHTML;r&&r.length>200&&(r=r.slice(0,200)),l({type:"click",page:{url:e.location.href,title:document.title},detail:{outerHTML:r,tagName:n&&n.tagName,id:n&&n.id,className:n&&n.className,name:n&&n.name},time:(new Date).getTime()})}function f(e,t){N=t,l({type:"navigation",detail:{from:e,to:t},time:(new Date).getTime()})}function p(t){if(a(h.getAttribute("apikey")||g.apikey)&&g.maxEventNumber&&!g.silent){g.maxEventNumber-=1;var n={notifierVersion:"0.0.5",userAgent:e.navigator.userAgent,locale:e.navigator.language||e.navigator.userLanguage,url:e.location.href,title:document.title,appVersion:h.getAttribute("appversion")||g.appversion,apiKey:h.getAttribute("apikey")||g.apikey,releaseStage:h.getAttribute("releasestage")||g.releasestage,metaData:t.metaData||g.metaData,user:t.user||g.user,name:t.name,time:(new Date).getTime(),message:t.message,fileName:t.fileName,lineNumber:t.lineNumber,columnNumber:t.columnNumber,stacktrace:t.stacktrace,type:t.type,severity:t.severity,target:t.target,breadcrumbs:b};for(var r in n);d(n)}}function d(t){var n,r="https://fundebug.com";if(n="undefined"==typeof JSON?s(t):JSON.stringify(t),e.XMLHttpRequest&&document.querySelector){var a=new XMLHttpRequest;a.open("POST",r+"/javascript/"),a.setRequestHeader("Content-Type","application/json"),a.send(n)}else{(new Image).src=r+"/javascript?event="+encodeURIComponent(n)}}var g={};e.fundebug=g;var v=!1,h=t();g.silent=h.getAttribute("silent")||!1,g.maxEventNumber=h.getAttribute("maxEventNumber")||10,n(e,"onerror",function(){return function(t,n,r,a,o){if(v)return void(v=!1);void 0===a&&e.event&&(a=e.event.errorCharacter);var c;c=n&&n!==e.location.href?n:null;var s=i(o);p({message:t,lineNumber:r,columnNumber:a,fileName:c||s&&s.fileName,name:s&&s.name||"uncaught error",stacktrace:o&&o.stack||u(),severity:"error",type:"uncaught"})}});var y=!0;if(e.atob){if(e.ErrorEvent)try{e.ErrorEvent.prototype.hasOwnProperty("error")&&(y=!1)}catch(e){}}else y=!1;"EventTarget Window Node ApplicationCache AudioTrackList ChannelMergerNode CryptoOperation EventSource FileReader HTMLUnknownElement IDBDatabase IDBRequest IDBTransaction KeyOperation MediaController MessagePort ModalWindow Notification SVGElementInstance Screen TextTrack TextTrackCue TextTrackList WebSocket WebSocketWorker Worker XMLHttpRequest XMLHttpRequestEventTarget XMLHttpRequestUpload".replace(/\w+/g,function(t){if(y){var a=e[t]&&e[t].prototype;a&&a.hasOwnProperty&&a.hasOwnProperty("addEventListener")&&(n(a,"addEventListener",function(e){return function(t,n,a,i){return n&&n.handleEvent&&(n.handleEvent=r(n.handleEvent)),e.call(this,t,r(n),a,i)}}),n(a,"removeEventListener",function(e){return function(t,n,a){return e.call(this,t,n,a),e.call(this,t,r(n),a)}}))}}),g.notify=function(e,t,n){if(e){return p({name:e||n&&n.name,message:t||n&&n.message,severity:n&&n.message||"warning",stacktrace:o(),type:"notification",user:n&&n.user,metaData:n&&n.metaData}),"请查看邮箱以及Fundebug控制台!"}},g.notifyError=function(e,t){if(e){var n=i(e);p({name:n.name||t&&t.name||"caught error",message:n.message||t&&t.message,stacktrace:e.stack,fileName:n.fileName,lineNumber:n.lineNumber,columnNumber:n.columnNumber,severity:t&&t.severity||"error",type:"caught",user:t&&t.user,metaData:t&&t.metaData})}},e.addEventListener&&e.addEventListener("unhandledrejection",function(e){g.notifyError(e.reason)});var b=[];e.addEventListener?e.addEventListener("click",m,!0):document.attachEvent("onclick",m);var N={url:e.location.href};document.addEventListener?document.addEventListener("DOMContentLoaded",function(){N={url:e.location.href,title:document.title}}):document.attachEvent("onreadystatechange",function(){N={url:e.location.href,title:document.title}});var E=e.onpopstate;e.onpopstate=function(){var t={url:e.location.href};if(N.title||(N.title=document.title),N.url!==t.url&&f(N,t),E)return E.apply(this,arguments)};var k=e.history.pushState;e.history.pushState=function(){N={url:e.location.href,title:document.title};var t={};if(3===arguments.length&&(t.url=arguments[2]),N.url!==t.url&&f(N,t),k)return k.apply(this,arguments)};var L=e.onhashchange;if(e.onhashchange=function(){var t={url:e.location.href,title:document.title};if(N.url!==t.url&&f(N,t),L)return L.apply(this,arguments)},e.XMLHttpRequest){var T=XMLHttpRequest.prototype;if(!T)return;var w,D,M=T.open,S=T.send;T.open=function(e,t){return w=e,D=t,M.apply(this,arguments)},T.send=function(){var t=this,n=t.onreadystatechange;return t.onreadystatechange=function(){if(4===t.readyState){l({type:"XMLHttpRequest",page:{url:e.location.href},detail:{method:w,url:t.responseURL||D,status:t.status,statusText:t.statusText},time:(new Date).getTime()})}n&&n.apply(this,arguments)},S.apply(this,arguments)}}if(e.fetch){var R=e.fetch;e.fetch=function(t,n){return R.apply(this,arguments).then(function(t){return l({type:"fetch",page:{url:e.location.href,title:document.title},detail:{method:n&&n.method||"GET",url:t.url,status:t.status,statusText:t.statusText},time:(new Date).getTime()}),t})}}var x="function"==typeof define,_="undefined"!=typeof module&&module.exports;x?define(g):_&&(module.exports=g)}(window);