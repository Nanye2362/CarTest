tb.UploadModule={defaultOption:null,init:function(e){this.defaultOption=e},upload:function(e,i){this.init(i),i.emptyFlag&&$("#"+i.selectId+"_img_list").html("");var t=tb.UploadModule.getPluplodInstance(i);$(e).data("uploader",t),tb.UploadModule.uploaderFilesAdd(t,i.imageLength)},getPluplodInstance:function(e){var i=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:e.selectId,url:e.url,flash_swf_url:"../plugins/plupload-2.1.2/js/Moxie.swf",silverlight_xap_url:"../plugins/plupload-2.1.2/js/Moxie.xap",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,gif,png"}]}});return i.init(),i},uploaderFilesAdd:function(e,i){e.bind("FilesAdded",function(e,i){var t=e.files.length,l=tb.UploadModule.defaultOption.imageLength;if(t>l){for(a=l;a<t;++a)e.files.pop();for(var i=e.files,a=0;a<i.length;++a)tb.UploadModule.renderHtml(e,i[a])}else plupload.each(i,function(i){tb.UploadModule.renderHtml(e,i)})})},uploadProgress:function(e){e.bind("UploadProgress",function(e,i){})},uploadComplete:function(e,i){e.bind("UploadComplete",function(e,t){i&&$.isFunction(i)&&0!=files.length&&i(files)})},uploadEvent:function(e){e.start()},uploadFileFinish:function(e,i){e.bind("FileUploaded",function(e,t,l){if(i&&$.isFunction(i)){var a=JSON.parse(l.response);"10010"==a.status?(Messenger().post({message:"上传文件成功",type:"success",hideAfter:3}),i(t,a)):Messenger().post({message:"上传文件失败",type:"error",hideAfter:3})}})},previewImage:function(e,i){if(e&&/image\//.test(e.type))if("image/gif"==e.type){var t=new mOxie.FileReader;t.onload=function(){i(t.result),t.destroy(),t=null},t.readAsDataURL(e.getSource())}else{var l=new mOxie.Image;l.onload=function(){l.downsize(300,300);var e="image/jpeg"==l.type?l.getAsDataURL("image/jpeg",80):l.getAsDataURL();i&&i(e),l.destroy(),l=null},l.load(e.getSource())}},renderHtml:function(e,i){var t=tb.UploadModule.defaultOption;if(0==$("#div_"+i.id).size()){var l='<li><div id="div_'+i.id+'">';l+='<a class="imgOperator" href="javascript:tb.UploadModule.removeImg(\''+i.id+'\',this);"  style="cursor:pointer;" id="del_'+i.id+'"><i class="fa fa-times"></i></a>',l+='<img id="'+i.id+'" title="'+i.name+'"><p>'+i.name+"("+plupload.formatSize(i.size)+")</img>",l+="</p></div></li>",$("#"+t.selectId+"_img_list").append(l),$("#"+i.id).data("uploadObj",e),tb.UploadModule.previewImage(i,function(e){$("#"+i.id).attr("src",e)})}},removeImg:function(e,i){var t=$("#"+e).data("uploadObj");if(t){var l=t.getFile(e);t.removeFile(l),$("#div_"+l.id).parent().remove()}}};
//# sourceMappingURL=tb-56d322aff5.upload.js.map
